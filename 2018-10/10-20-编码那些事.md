# 文件编码方式
使用过windows、Linux的同学一定知道在两者之间传输文件极有可能打开后乱码，那就是因为编码方式不对，写入和读取时编码方式不统一，造成打开后显示全是乱码。  windows同学可以直接使用txt测试一下，将文本保存为GBK后，再用utf8打开，看看是不是乱码。 

## 常见编码方式
- Ascii编码: American Standard Code for Information Interchange，美国信息互换标准代码。在1967年，还只有英语国家接触计算机的年代，简单的26个字母加少量符号和控制符便可以满足计算机所有展示需求，因此使用了两个字节的7位组成了128个字符。 这也就是常说的Ascii占7位二进制。 但之后进行过扩展，将两个字节的8位二进制全部使用，构成了256个字符，这也就是另一个版本: Ascii占8位。 但常用的还是最初的那7位Ascii码的128个字符。[ASCII表](http://www.asciitable.com/)，在官方表单中可以看到上面的表格即常说的128个Ascii码，下面的表格称为扩展Ascii码，也即128-256所占用的码。

- GB2312:中华人民共和国国家标准简体中文字符集，俗称国标码。 当我国进入信息领域，可以预见到到，原本的两个字节共256个字符明显不足以装下数万的汉子，甚至还有简繁体之说。机智的我国人民发明了部分兼容ASCII在内的，同时包含数学符号、罗马希腊字母、日文片假名在内的字符集。

- Unicode: Universal Multiple-Octet Coded Character Set，通用多八位编码字符集。由于有多种编码方式的存在，很不方便，于是就有人提出要制定一套可以包含人类所有语言和符号的标准，这个标准其实是一个字符集，一个所有字符对应的转换码。 Unicode就是这样一个字符集，它不是一个具体的编码实现，但它规定了每个字符应该对应的唯一ID(学名也叫码位 / 码点 / Code Point)，当每一个字符都有唯一的对应ID时，文件使用一种符合Unicode的编码实现方法即可包含所有的人类语言、符号，不会出现日语与汉字并存时乱码的问题了。 [Unicode Table](http://www.unicode.org/charts/)展示了Unicode所定义的所有字符集合，

- UTF-8: 是Unicode编码标准的一种实现，UTF-8是一种变长的编码方式，最多占用4个字节。UTF8就是在计算机中将Unicode中所定义的映射表实现的一种方式，将字符转为计算机可以理解的存储方式，并且要求可双向转换，即编码、解码。

## 文件编码查看方式
下面两个命令基于Linux系统。
### file命令---查看文件的编码方式
执行 `file test.txt` 就会得到类似于 `test.txt: UTF-8 Unicode text`这样的答案，其返回值就表示了文件的编码方式。

### od命令---查看文件的二进制内容
执行 `vim test.txt` 命令并输入一个 **范**字(8303)。 通过 `od -x test.txt`。[od命令_Linux od 命令用法详解：输出文件的八进制、十六进制等格式编码的字节](http://man.linuxde.net/od)


### Big endian or little endian
字节序。 其实就是说话的顺序。  如果要表达 我吃鱼，一定要双方都理解的顺序，吃的是`鱼`，。  如果这句话在对方听到后顺序颠倒了，变成了  **鱼吃我**， 那就是灵异事件了，因此交流的双方必须确保对语言的理解顺序是一致的才可以。 同样计算机也有这样两个规定。  
- Little-Endian又称小端就是低位字节排放在内存的低地址端，高位字节排放在内存的高地址端。
- Big-Endian又称大端就是高位字节排放在内存的低地址端，低位字节排放在内存的高地址端。

举个栗子：存储0x1234在内存中，假设其实内存地址为0x5000

|内存地址 | Little-Endian | Big-Endian|
| ------ | ------ | ------ |
| 0x5000 | 0x34 | 0x12 |
| 0x5001 | 0x12 | 0x34 |

高低字节序的差异在于将高位还是低位内存地址作为数据存储的起始位置，这点我们无需过度关心，不同的设备采用不同的方案。例如Internet传输都是Big endian，而大部分X86计算机都为little endian，但在传输需要时操作系统已经帮我们做了转换。
## 编码内容解析实操
通过对Ascii和UTF8编码的实际案例来解释其编码和解码过程。
### Ascii
#### 编写Ascii文件：
创建一个Ascii文件，并写入`qwer`作为内容(不要写入汉字，因为Ascii不支持汉字)。 并通过`file`命令确保文件为`test.txt: ASCII text`。
#### 查看文件二进制码：
首先通过查看前面给出的Ascii Table可以得出

|字符 | 二进制 | 八进制|  十六进制 |
| ------ | ------ | ------ | ------ |
| q | 01110001 | 161 | 71 |
| w | 01110111 | 167 | 77 |
| e | 01100101 | 145 | 65 |
| r | 01110010 | 162 | 72 |

通过 `od -x test.txt`得到文件的十六进制内容为`7771    7265`。刚好是按照大端来显示的qwer所对应的Ascii编码。可以推断出其二进制内容为`0111011101110001 0111001001100101`转换为8进制-->`73561 71145`,通过`od -o test.txt`命令来检验一下-->`073561  071145`,可以发现我们的推算和od命令结果一致。
#### Ascii总结：
通过上面的例子，可以发现Ascii的编码较为简单，通过映射Table，便可将对应的字符存储为相应的二进制内容
### UTF8
#### UTF8编码规则：
UTF8为了兼容Ascii并且节省空间，采用了变长的4位字节来实现Unicode字符集。 

|Unicode字符集序号 | UTF-8 二进制转换 |
| ----- | ----- | 
|0000 0000-0000 007F | 0xxxxxxx| 
|0000 0080-0000 07FF | 110xxxxx 10xxxxxx |
|0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx|
|0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx|

其中xxxx为真正Unicode字符集中字符对应序号的二进制转换。更全的UTF8编码规则，查看[UTF8 definition](http://www.ietf.org/rfc/rfc3629.txt)

如`范`字的Unicode编号为`8303(16进制)`将其转为二进制`1000001100000011(二进制)`，8303属于上述表格的第三行，即UTF8实现为三个字节。 将真正的二进制码填进去xxx的位置，便组成了`11101000 10001100 10000011`,再将其转为十六进制为`E8 8C 83`。

查看网络中的[UTF8汉字对应表](https://blog.csdn.net/qiaqia609/article/details/8069678),在其中寻找`范`对应的UTF8编码，可以验证上述的推倒示例是正确的。
#### 编写UTF8文件：
创建一个UTF8文件，并写入`范老板`作为内容。 并通过`file`命令确保文件为`test.txt: UTF-8 Unicode text`。
#### 查看文件编码：
首先查表可以得出

|Unicode字符集序号 | UTF-8 十六进制表示 |
| ----- | ----- |
| 范 | E8 8C 83 |
| 老 | E8 80 81 |
| 板 | E6 9D BF |

通过`od -x test.txt`命令得到的十六进制内容确实符合上述UTF8映射的大端存储即`8ce8    e883    8180    9de6    0abf`。
#### UTF8总结：
根据上面介绍的Unicode字符集向UTF8的实现其实就是编码的过程，将其反过来就是解码的过程。 我们可以发现其实解码也是可以唯一确定的，完全可逆的。其二进制有鲜明的特点，如果以0开头则一定是一个字符，以110、1110、11110开头则确定由几个字节构成这个字符，以10开头则一定和前面共同N个字节组成一个字符。

## 总结
由上面对Ascii、gb2312以及Unicode的简短介绍可以看出编码正在向大而全方向发展，Unicode正在试图囊括人类全部语言、符号。

通过对Ascii和UTF8编码的文件分析，可以知道日常我们的文件是如何以二进制形式存储的，毕竟机器只能看懂二进制内容。 其编码解码的过程就有点初级密码加密、解密的意思。

## 参考
- [ASCII表](http://www.asciitable.com/)
- [Unicode Table](http://www.unicode.org/charts/)
- [od命令_Linux od 命令用法详解：输出文件的八进制、十六进制等格式编码的字节](http://man.linuxde.net/od)
- [UTF8 definition](http://www.ietf.org/rfc/rfc3629.txt)
- [UTF8汉字对应表](https://blog.csdn.net/qiaqia609/article/details/8069678)
- [字符编码笔记：ASCII，Unicode 和 UTF-8](http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html)
- [轻松记住大端小端的含义](https://blog.csdn.net/goodmentc/article/details/52207560)
